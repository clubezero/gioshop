<!doctype html>
<html lang="pt-br">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>gioShop | SISTEMA DE FATURAMENTO</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">
</head>

<body class="bg-light">

    <nav class="navbar navbar-expand-lg sticky-top mb-4">
        <div class="container">
            <a class="navbar-brand fw-bold text-primary fs-3" href="{{url_for('home')}}">gioShop</a>
            <div class="dropdown">
                <button class="btn btn-light rounded-pill dropdown-toggle" data-bs-toggle="dropdown">
                    <i class="bi bi-person-circle me-1 text-success"></i> <span class="text-success">Minha Conta</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-end border-0 shadow">
                    <li><a class="dropdown-item text-primary" href=" {{url_for('marke')}}">Marketplace</a></li>
                    <li><a class="dropdown-item text-primary" href="{{url_for('funcionamento')}}">Como funciona</a></li>
                    <li><a class="dropdown-item text-primary" href="{{url_for('solicitar_saque')}}">Solicitar Saque</a>
                    </li>
                    <li><a class="dropdown-item text-primary" href="#">Minhas vendas</a></li>
                    <li><a class="dropdown-item text-primary" href="#">Carteira</a></li>
                    <li><a class="dropdown-item text-danger" href="{{url_for('logout')}}">Sair</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="row g-4">
            <div class="col-lg-4">
                <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                    <div class="profile-header"></div>
                    <div class="card-body text-center p-4">
                        <div class="profile-avatar-wrapper mb-3">
                            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Giovanni"
                                class="profile-avatar shadow-sm" alt="Avatar">
                            <span class="level-badge-float">{% if current_user.motor_id == 0 %}
                                Motor Padrão
                                {% elif current_user.motor_id == 1 %}
                                Nível 1 (Impulso)
                                {% elif current_user.motor_id == 2 %}
                                NÍVEL 2 (Turbo)
                                {% elif current_user.motor_id == 3 %}
                                NÍVEL 3 (Fusão)
                                {% elif current_user.motor_id == 4 %}
                                NÍVEL 4 (Supremo)
                                {% else %}
                                NÍVEL 0 (Nuclear)
                                {% endif %}</span>
                        </div>
                        <h4 class="fw-bold mb-0">{{current_user.nome}} {{current_user.sobrenome}}</h4>
                        <p class="text-muted small mb-3"><span class="text-primary">Membro
                                desde:</span> {{current_user.data}}</p>

                        <div class="d-grid gap-2">
                            <a class="btn btn-primary rounded-pill" href="{{url_for('perfil')}}"><i
                                    class="bi bi-pencil-square me-2"></i>Editar Perfil</a>
                        </div>
                    </div>
                </div>

                <div class="card border-0 shadow-sm rounded-4 mt-4 p-4">
                    <h6 class="fw-bold mb-3">Segurança da Conta</h6>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span class="small text-muted">Status:</span>
                        <span class="badge bg-success-subtle text-success">Verificado</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="small text-muted">KYC (Documentos):</span>
                        <span class="badge bg-warning-subtle text-warning">Pendente</span>
                    </div>
                </div>
            </div>

            <div class="col-lg-8">
                <div class="card engine-status-card shadow-sm p-4 mb-4 border-start border-primary border-5">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h5 class="fw-bold text-primary mb-1">Status do Motor: Padrão</h5>
                            <p class="text-muted small">Sua taxa de aceleração atual é de <strong>2% a cada 10
                                    dias</strong>.</p>







                            <div class="task-container p-3 border rounded-4 bg-white shadow-sm">
                                <div class="d-flex justify-content-between mb-1">
                                    <span class="fw-bold small">Progresso do Ciclo (10 dias)</span>
                                    <span id="progress-text" class="fw-bold small text-primary">0%</span>
                                </div>
                                <div class="progress mb-2" style="height: 12px;">
                                    <div id="task-progress-bar"
                                        class="progress-bar progress-bar-striped progress-bar-animated bg-primary"
                                        role="progressbar" style="width: 0%">
                                    </div>
                                </div>
                                <small class="text-muted" id="days-remaining">Calculando dias restantes...</small>
                            </div>





                            <!--                        <div class="progress mb-2" style="height: 10px;">
                                <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar"
                                    style="width: 10%"></div>
                            </div>-->



                            <small class="text-muted">Faltam 4 dias para o próximo ciclo de lucro.</small>
                        </div>
                        <div class="col-md-4 text-center mt-3 mt-md-0">
                            <a href="{{url_for('funcionamento')}}"
                                class="btn btn-outline-primary rounded-pill btn-sm">Upgrade de
                                Motor</a>
                        </div>
                    </div>
                </div>

                <div class="row g-3 mb-4">
                    <div class="col-6 col-md-4">
                        <div class="stat-box shadow-sm">
                            <small class="text-muted d-block">Saldo Disponível</small>
                            <span class="fw-bold fs-5">{{current_user.balance}} Kz</span>
                        </div>
                    </div>
                    <div class="col-6 col-md-4">
                        <div class="stat-box shadow-sm">
                            <small class="text-muted d-block">Em Processamento</small>
                            <span class="fw-bold fs-5 text-warning">{{current_user.saques | last}} Kz</span>
                        </div>
                    </div>
                    <div class="col-12 col-md-4">
                        <div class="stat-box shadow-sm border-success border-opacity-25 bg-success-subtle">
                            <small class="text-muted d-block">Total Sacado</small>
                            <span class="fw-bold fs-5 text-success">42.000 Kz</span>
                        </div>
                    </div>
                </div>

                <div class="card border-0 shadow-sm rounded-4 p-4">
                    <h5 class="fw-bold mb-4">Configurações de Saque</h5>
                    <form>
                        <div class="mb-3">
                            <label class="form-label small fw-bold">PIX</label>
                            <input type="text" class="form-control rounded-pill bg-light border-0"
                                value="{{current_user.pix | last}}" readonly>
                        </div>
                        <div class="mb-3">
                            <label class="form-label small fw-bold">E-mail para Notificações</label>
                            <input type="email" class="form-control rounded-pill bg-light border-0"
                                value="{{current_user.email}}" readonly>
                        </div>
                        <a href="{{url_for('solicitar_saque')}}" class="btn btn-dark rounded-pill px-4">Solicitar
                            saque</a>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <footer class="py-5 text-center text-muted small">
        © 2026 gioShop - Quantum Engineering Identity
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js">


        function updateTaskProgress(startDateStr) {
            const progressBar = document.getElementById('task-progress-bar');
            const progressText = document.getElementById('progress-text');
            const daysLabel = document.getElementById('days-remaining');

            const startDate = new Date(startDateStr);
            const today = new Date();

            // Diferença em milissegundos convertida para dias
            const diffTime = Math.abs(today - startDate);
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

            // Cálculo da porcentagem (Limite de 100%)
            let percentage = (diffDays / 10) * 100;
            if (percentage > 100) percentage = 100;

            // Atualização visual
            progressBar.style.width = percentage + "%";
            progressText.innerText = Math.floor(percentage) + "%";

            if (percentage >= 100) {
                daysLabel.innerHTML = "<strong>Ciclo Concluído!</strong> Lucro disponível para saque.";
                progressBar.classList.replace('bg-primary', 'bg-success');
            } else {
                daysLabel.innerText = `Dia ${diffDays} de 10. Faltam ${10 - diffDays} dias para o rendimento total.`;
            }
        }

        // Exemplo de uso: Digamos que o usuário ativou o motor há 3 dias
        // No seu template real, o Python enviaria a data de ativação aqui
        updateTaskProgress('2026-02-18');


    </script>
</body>

</html>